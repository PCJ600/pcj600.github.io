<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Effective Python 笔记 | PC&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="前言不错的Python进阶书。写这个笔记的目的是，把书中提到的编写高质量Python的59个方法的要点记录下来，便于今后的工作中查阅 第1章：用Pythonic方式来思考">
<meta property="og:type" content="article">
<meta property="og:title" content="Effective Python 笔记">
<meta property="og:url" content="https://pcj600.github.io/2023/0812215151.html">
<meta property="og:site_name" content="PC&#39;s Blog">
<meta property="og:description" content="前言不错的Python进阶书。写这个笔记的目的是，把书中提到的编写高质量Python的59个方法的要点记录下来，便于今后的工作中查阅 第1章：用Pythonic方式来思考">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-08-12T13:51:51.000Z">
<meta property="article:modified_time" content="2024-08-18T13:52:41.572Z">
<meta property="article:author" content="PC">
<meta property="article:tag" content="Python">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="PC's Blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">PC&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Life is short, Play more!</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://pcj600.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="next-2023-08-12-effective-python-note" class="h-entry article article-type-next" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/0812215151.html" class="article-date">
  <time class="dt-published" datetime="2023-08-12T13:51:51.000Z" itemprop="datePublished">2023-08-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Python/">Python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Effective Python 笔记
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>不错的Python进阶书。写这个笔记的目的是，把书中提到的编写高质量Python的59个方法的要点记录下来，便于今后的工作中查阅</p>
<h1 id="第1章：用Pythonic方式来思考"><a href="#第1章：用Pythonic方式来思考" class="headerlink" title="第1章：用Pythonic方式来思考"></a>第1章：用Pythonic方式来思考</h1><span id="more"></span>

<h2 id="x20-1-用Pythonic方式来思考"><a href="#x20-1-用Pythonic方式来思考" class="headerlink" title="&#x20;1. 用Pythonic方式来思考"></a>&#x20;1. 用Pythonic方式来思考</h2><p>python之禅 —— <code>import this</code></p>
<h2 id="x20-2-遵循PEP8风格"><a href="#x20-2-遵循PEP8风格" class="headerlink" title="&#x20;2. 遵循PEP8风格"></a>&#x20;2. 遵循PEP8风格</h2><p>PEP8 —— Python Enhancement Proposal #8</p>
<p>空白：</p>
<ul>
<li>使用空格而不是tab表示缩进</li>
<li>和语法相关每一层缩进用4个空格</li>
<li>每行字符数不超过79</li>
<li>占据多行表达式，除首行外其余各行应在通常缩进级别上加4空格</li>
<li>函数与类之间两个空行隔开</li>
<li>同一个类中，各方法一个空行隔开</li>
<li>使用下标获取元素，不要在两旁加空格</li>
<li>为变量赋值，赋值符号左侧和右侧各自写一个空格，不要在两旁添加空格</li>
</ul>
<p>命名：</p>
<ul>
<li>函数、变量、属性用小写，各单词以下划线连接</li>
<li>受保护实例属性，以单下划线开头</li>
<li>私有实例属性：以两个下划线开头</li>
<li>类以异常，应每个单词以大写形式命名，如CapitalizedWord</li>
<li>模块级别常量，应全部采用大写，各单词以下划线相连，如ALL_CAPS</li>
<li>类中实例方法，应该把首个参数命名为self，以表示对象自身</li>
<li>类方法首个参数，应该命名为cls，以表示类自身</li>
</ul>
<p>表达式和语句：</p>
<ul>
<li>采用内联形式否定词，而不是把否定词放在整个表达式前面，例如写if a is not b 而不是 if not a is b</li>
<li>不要通过测长度方法判断list是否为空，应采用if not list，空值会自动评估为False</li>
<li>import语句总应放在文件开头</li>
<li>引入模块时总应使用绝对名称，不应根据当前模块路径使用相对名称，例如引入bar包中的foo模块，应完整写出from bar import foo，不应该简写import foo</li>
<li>文件中import语句应按顺序划三部分，分别表示标准库模块，第三方模块，自用模块，各部分中的import语句应按模块的字母顺序排列</li>
</ul>
<h2 id="3-了解bytes-str-unicode区别"><a href="#3-了解bytes-str-unicode区别" class="headerlink" title="3. 了解bytes, str, unicode区别"></a>3. 了解bytes, str, unicode区别</h2><ul>
<li>Python3中，bytes是一个包含8位置的序列，str是一种包含unicode字符序列</li>
</ul>
<h2 id="4-用辅助函数取代复杂表达式"><a href="#4-用辅助函数取代复杂表达式" class="headerlink" title="4. 用辅助函数取代复杂表达式"></a>4. 用辅助函数取代复杂表达式</h2><p>开发者容易过度运用Python语法特性，写出特别复杂难以理解的单行表达式。<strong>这种情况需要把复杂表达式移到辅助函数</strong></p>
<h2 id="5-了解切割序列的方法"><a href="#5-了解切割序列的方法" class="headerlink" title="5. 了解切割序列的方法"></a>5. 了解切割序列的方法</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;h&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[:<span class="number">4</span>]</span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[<span class="number">5</span>:]</span><br><span class="line">[<span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;h&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[-<span class="number">2</span>:]</span><br><span class="line">[<span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;h&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[<span class="number">2</span>:-<span class="number">3</span>]</span><br><span class="line">[<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[:]</span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;h&#x27;</span>]</span><br><span class="line">a[<span class="number">2</span>:<span class="number">6</span>] = [<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;o&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;h&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h2 id="6-单次切片操作内，不要同时指定start-end-stride"><a href="#6-单次切片操作内，不要同时指定start-end-stride" class="headerlink" title="6. 单次切片操作内，不要同时指定start, end, stride"></a>6. 单次切片操作内，不要同时指定start, end, stride</h2><p>除了基本切片操作，Python还提供了somelist[start:end:stride]形式写法，以实现步进式切割，就是从每n个元素里取1个出来</p>
<p>既有start, end，又有stride的切割操作，可能令人费解，考虑拆解两条语句，其中一条做范围切割，另一条做步进切割，如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b = a[::<span class="number">2</span>]    <span class="comment"># [&#x27;a&#x27;, &#x27;c&#x27;, &#x27;e&#x27;, &#x27;g&#x27;]</span></span><br><span class="line">c = b[<span class="number">1</span>:-<span class="number">1</span>]   <span class="comment"># [&#x27;c&#x27;, &#x27;e&#x27;]</span></span><br></pre></td></tr></table></figure>

<h2 id="x20-7-用列表推导取代map-filter"><a href="#x20-7-用列表推导取代map-filter" class="headerlink" title="&#x20;7. 用列表推导取代map, filter"></a>&#x20;7. 用列表推导取代map, filter</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">squares = [ x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> a ]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(squares)</span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>]</span><br><span class="line">或者<span class="built_in">map</span>, <span class="built_in">filter</span></span><br><span class="line">squares = <span class="built_in">map</span>(<span class="keyword">lambda</span> x: x ** <span class="number">2</span>, a)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(squares)</span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>]</span><br></pre></td></tr></table></figure>

<h2 id="8-不要使用含有两个以上表达式的列表推导"><a href="#8-不要使用含有两个以上表达式的列表推导" class="headerlink" title="8. 不要使用含有两个以上表达式的列表推导"></a>8. 不要使用含有两个以上表达式的列表推导</h2><p>例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">my_lists = [</span><br><span class="line">    [[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>], [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]],</span><br><span class="line">]</span><br><span class="line">flat = [x <span class="keyword">for</span> sublist1 <span class="keyword">in</span> my_lists</span><br><span class="line">		  <span class="keyword">for</span> sublist2 <span class="keyword">in</span> sublist1</span><br><span class="line">		  <span class="keyword">for</span> x <span class="keyword">in</span> sublist2]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以看出，列表推导写法不够简洁，改用普通循环语句实现相同效果</span></span><br><span class="line">flat = []</span><br><span class="line"><span class="keyword">for</span> sublist1 <span class="keyword">in</span> my_lists:</span><br><span class="line">	<span class="keyword">for</span> sublist2 <span class="keyword">in</span> sublist1:</span><br><span class="line">		flat.extend(sublist2)</span><br></pre></td></tr></table></figure>

<h2 id="9-用生成器表达式改写数据量较大的列表推导"><a href="#9-用生成器表达式改写数据量较大的列表推导" class="headerlink" title="9. 用生成器表达式改写数据量较大的列表推导"></a>9. 用生成器表达式改写数据量较大的列表推导</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">it = (<span class="built_in">len</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">open</span>(<span class="string">&#x27;file.txt&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(it)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">generator obj at XXX</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(it))</span><br></pre></td></tr></table></figure>

<h2 id="10-尽量用enumerate取代range"><a href="#10-尽量用enumerate取代range" class="headerlink" title="10. 尽量用enumerate取代range"></a>10. 尽量用enumerate取代range</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flavor_list = [<span class="string">&#x27;vanilla&#x27;</span>, <span class="string">&#x27;chocolate&#x27;</span>, <span class="string">&#x27;pecan&#x27;</span>, <span class="string">&#x27;strawberry&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> i, flavor <span class="keyword">in</span> <span class="built_in">enumerate</span>(flavor_list):</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;%d: %s&#x27;</span> % (i + <span class="number">1</span>, flavor))</span><br></pre></td></tr></table></figure>

<p>还可以直接指定enumerate函数开始计数时所用值，这样能把代码写的更短</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i, flavor <span class="keyword">in</span> <span class="built_in">enumerate</span>(flavor_list, <span class="number">1</span>):</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;%d: %s&#x27;</span> % (i, flavor))</span><br></pre></td></tr></table></figure>

<h2 id="11-用zip函数同时遍历两个迭代器"><a href="#11-用zip函数同时遍历两个迭代器" class="headerlink" title="11. 用zip函数同时遍历两个迭代器"></a>11. 用zip函数同时遍历两个迭代器</h2><p>使用range或enumerate方法的代码不够简洁</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">names = [<span class="string">&#x27;Cecilia&#x27;</span>, <span class="string">&#x27;Lise&#x27;</span>, <span class="string">&#x27;Marie&#x27;</span>]</span><br><span class="line">letters = [ <span class="built_in">len</span>(s) <span class="keyword">for</span> s <span class="keyword">in</span> names]</span><br><span class="line"></span><br><span class="line">longest_name = <span class="literal">None</span></span><br><span class="line">max_letters = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i, name <span class="keyword">in</span> <span class="built_in">enumerate</span>(names):</span><br><span class="line">    <span class="keyword">if</span> letters[i] &gt; max_letters:</span><br><span class="line">        max_letters = letters[i]</span><br><span class="line">        longest_name = name</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;longest_name: &#x27;</span>, longest_name)</span><br></pre></td></tr></table></figure>

<p>改用内置zip方法，使代码更清晰</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">names = [<span class="string">&#x27;Cecilia&#x27;</span>, <span class="string">&#x27;Lise&#x27;</span>, <span class="string">&#x27;Marie&#x27;</span>]</span><br><span class="line">letters = [ <span class="built_in">len</span>(s) <span class="keyword">for</span> s <span class="keyword">in</span> names]</span><br><span class="line"></span><br><span class="line">longest_name = <span class="literal">None</span></span><br><span class="line">max_letters = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> name, count <span class="keyword">in</span> <span class="built_in">zip</span>(names, letters):</span><br><span class="line">    <span class="keyword">if</span> count &gt; max_letters:</span><br><span class="line">        longest_name = name</span><br><span class="line">        max_letters = count</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;longest_name: &#x27;</span>, longest_name)</span><br></pre></td></tr></table></figure>

<p>注意点：</p>
<ul>
<li>Python2中zip不是生成器，而是会把开发者提供那些迭代器都平行遍历一次，可能占用大量内存导致程序崩溃</li>
<li>如果输入迭代器长度不同，zip会提前终止，将导致意外结果</li>
</ul>
<h2 id="12-不要在for和while循环后写else块"><a href="#12-不要在for和while循环后写else块" class="headerlink" title="12. 不要在for和while循环后写else块"></a>12. 不要在for和while循环后写else块</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;Loop %d&#x27;</span> % i)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;Else block!&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>else块会在整个循环执行完之后立刻运行</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Loop %d&#x27;</span> % i)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Else block!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">$ python test.py</span><br><span class="line">Loop <span class="number">0</span></span><br><span class="line">Loop <span class="number">1</span></span><br><span class="line">Loop <span class="number">2</span></span><br><span class="line">Else block!</span><br></pre></td></tr></table></figure>

<ul>
<li>循环里用break提前跳出，会导致else块不执行</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;Loop %d&#x27;</span> % i)</span><br><span class="line">	<span class="keyword">if</span> i == <span class="number">1</span>:</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;Else block!&#x27;</span>)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">Loop <span class="number">0</span></span><br><span class="line">Loop <span class="number">1</span></span><br></pre></td></tr></table></figure>

<ul>
<li>如果for循环遍历序列是空的，就会立刻执行else块</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> []:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;Never runs&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;For Else block!&#x27;</span>)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">For Else block!</span><br></pre></td></tr></table></figure>

<p>要点：不要在循环后使用else块，这种写法即不直观，又容易让人误解</p>
<h2 id="13-合理利用try-except-else-finally结构中每个代码块"><a href="#13-合理利用try-except-else-finally结构中每个代码块" class="headerlink" title="13. 合理利用try&#x2F;except&#x2F;else&#x2F;finally结构中每个代码块"></a>13. 合理利用try&#x2F;except&#x2F;else&#x2F;finally结构中每个代码块</h2><ul>
<li>无论try是否异常，都可利用try&#x2F;finally复合语句中finally块执行清理工作</li>
<li>else块可用来缩减try代码量，并把没有发生异常所要执行的语句与try&#x2F;except分开</li>
<li>顺利运行try块后，若想使某些操作能在finaly块的清理代码前执行，可将这些操作写到else</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">UNDEFINED = <span class="built_in">object</span>()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">divide_json</span>(<span class="params">path</span>):</span><br><span class="line">	handle = <span class="built_in">open</span>(path, <span class="string">&#x27;r+&#x27;</span>)</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		data = handle.read()</span><br><span class="line">		op = json.loads(data)</span><br><span class="line">		value = (op[<span class="string">&#x27;numerator&#x27;</span>]/op[<span class="string">&#x27;denominator&#x27;</span>])</span><br><span class="line">	<span class="keyword">except</span> ZeroDivisionError es e:</span><br><span class="line">		<span class="keyword">return</span> UNDEFINED</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">	    op[<span class="string">&#x27;result&#x27;</span>] = value</span><br><span class="line">	    result = json.dumps(op)</span><br><span class="line">	    handle.seek(<span class="number">0</span>)</span><br><span class="line">	    handle.write(result)</span><br><span class="line">	    <span class="keyword">return</span> value</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">	    handle.close()</span><br></pre></td></tr></table></figure>

<h1 id="第2章-函数"><a href="#第2章-函数" class="headerlink" title="第2章 函数"></a>第2章 函数</h1><h2 id="14-尽量用异常来表示特殊情况，而不返回Nones"><a href="#14-尽量用异常来表示特殊情况，而不返回Nones" class="headerlink" title="14. 尽量用异常来表示特殊情况，而不返回Nones"></a>14. 尽量用异常来表示特殊情况，而不返回Nones</h2><p>例：令函数返回None，可能会使调用该函数人犯错</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">divide</span>(<span class="params">a, b</span>):</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		<span class="keyword">return</span> a / b</span><br><span class="line">	<span class="keyword">except</span> ZeroDivisionError:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">x,y = <span class="number">0</span>, <span class="number">5</span></span><br><span class="line">result = divide(x, y)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> result:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;Invaid inputs&#x27;</span>) <span class="comment"># This is WRONG !</span></span><br></pre></td></tr></table></figure>

<p>改进方法一： 把返回值拆两部分，例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">divide</span>(<span class="params">a, b</span>):</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">True</span>, a / b</span><br><span class="line">	<span class="keyword">except</span> ZeroDivisionError:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">False</span>, <span class="literal">None</span></span><br></pre></td></tr></table></figure>

<p>改进方法二：给上一级抛异常</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">divide</span>(<span class="params">a, b</span>):</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		<span class="keyword">return</span> a / b:</span><br><span class="line">	<span class="keyword">except</span> ZeroDivisionError <span class="keyword">as</span> e:</span><br><span class="line">		<span class="keyword">raise</span> ValueError(<span class="string">&#x27;Invalid inputs&#x27;</span>) <span class="keyword">from</span> e</span><br></pre></td></tr></table></figure>

<h2 id="15-了解如何在闭包里使用外围作用域中的变量"><a href="#15-了解如何在闭包里使用外围作用域中的变量" class="headerlink" title="15. 了解如何在闭包里使用外围作用域中的变量"></a>15. 了解如何在闭包里使用外围作用域中的变量</h2><p>使用nonlocal获取闭包内的数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">sort_priority3</span>(<span class="params">numbers, group</span>):</span><br><span class="line">	found = <span class="literal">False</span></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">helper</span>(<span class="params">x</span>):</span><br><span class="line">		<span class="keyword">nonlocal</span> found</span><br><span class="line">		<span class="keyword">if</span> x <span class="keyword">in</span> group:</span><br><span class="line">			found = <span class="literal">True</span></span><br><span class="line">			<span class="keyword">return</span> (<span class="number">0</span>, x)</span><br><span class="line">		<span class="keyword">return</span> (<span class="number">1</span>, x)</span><br><span class="line">	numbers.sort(key=helper)</span><br><span class="line">	<span class="keyword">return</span> found</span><br></pre></td></tr></table></figure>

<h2 id="16-用生成器改写直接返回列表函数"><a href="#16-用生成器改写直接返回列表函数" class="headerlink" title="16. 用生成器改写直接返回列表函数"></a>16. 用生成器改写直接返回列表函数</h2><p>这种写法的问题是，返回前要把所有结果放在列表里，如果输入量非常大，程序可能耗尽内存崩溃</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">index_words</span>(<span class="params">text</span>):</span><br><span class="line">	result = []</span><br><span class="line">	<span class="keyword">if</span> text:</span><br><span class="line">		result.append(<span class="number">0</span>)</span><br><span class="line">	<span class="keyword">for</span> index, letter <span class="keyword">in</span> <span class="built_in">enumerate</span>(text):</span><br><span class="line">		<span class="keyword">if</span> letter == <span class="string">&#x27; &#x27;</span>:</span><br><span class="line">			result.append(index + <span class="number">1</span>)</span><br><span class="line">	<span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">address = <span class="string">&#x27;Four score and seven years ago...&#x27;</span></span><br><span class="line">result = index_words(address)</span><br><span class="line"><span class="built_in">print</span>(result[:<span class="number">3</span>])</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">[<span class="number">0</span>, <span class="number">5</span>, <span class="number">11</span>]</span><br></pre></td></tr></table></figure>

<p>用生成器改写会更好，生成器用yield表达式函数，调用生成器函数时，不会真的运行，而是返回迭代器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">index_word_iter</span>(<span class="params">text</span>):</span><br><span class="line">	<span class="keyword">if</span> text:</span><br><span class="line">		<span class="keyword">yield</span> <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> index, letter <span class="keyword">in</span> <span class="built_in">enumerate</span>(text):</span><br><span class="line">		<span class="keyword">if</span> letter == <span class="string">&#x27; &#x27;</span>:</span><br><span class="line">			<span class="keyword">yield</span> index + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">address = <span class="string">&#x27;Four score and seven years ago...&#x27;</span></span><br><span class="line">result = <span class="built_in">list</span>(index_words_iter(address))</span><br><span class="line">[<span class="number">0</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">21</span>, <span class="number">27</span>]</span><br></pre></td></tr></table></figure>

<h2 id="17-在参数上迭代时，多加小心"><a href="#17-在参数上迭代时，多加小心" class="headerlink" title="17. 在参数上迭代时，多加小心"></a>17. 在参数上迭代时，多加小心</h2><p>函数在输入参数上多次迭代时要当心，如果参数是迭代器，可能导致奇怪的行为并错失某些值</p>
<h2 id="18-用数量可变位置参数减少视觉杂讯-visual-noise"><a href="#18-用数量可变位置参数减少视觉杂讯-visual-noise" class="headerlink" title="18. 用数量可变位置参数减少视觉杂讯 (visual noise)"></a>18. 用数量可变位置参数减少视觉杂讯 (visual noise)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">log</span>(<span class="params">message, *values</span>):</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> values:</span><br><span class="line">		<span class="built_in">print</span>(message)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		values_str = <span class="string">&#x27;, &#x27;</span>.join(<span class="built_in">str</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> values)</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&#x27;%s: %s&#x27;</span> % (message, values_str))</span><br><span class="line"></span><br><span class="line">log(<span class="string">&#x27;My numbers are&#x27;</span>, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">log(<span class="string">&#x27;Hi there&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>要点：</p>
<ul>
<li>def语句中使用*args, 即可令函数接收数量可变的位置参数</li>
<li>在已经接收*args参数的函数上继续添加位置参数，可能产生难以排查的BUG</li>
</ul>
<h2 id="19-用关键字参数表达可选的行为"><a href="#19-用关键字参数表达可选的行为" class="headerlink" title="19. 用关键字参数表达可选的行为"></a>19. 用关键字参数表达可选的行为</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">remainder</span>(<span class="params">number, divisor</span>):</span><br><span class="line">	<span class="keyword">return</span> number % divisor</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>下面这些调用，都是等效的</span><br><span class="line">remainder(<span class="number">20</span>, <span class="number">7</span>)</span><br><span class="line">remainder(<span class="number">20</span>, divisor=<span class="number">7</span>)</span><br><span class="line">remainder(number=<span class="number">20</span>, divisor=<span class="number">7</span>)</span><br><span class="line">remainder(ivisor=<span class="number">7</span>, number=<span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<p>灵活使用关键字参数，提供如下好处：</p>
<ul>
<li>更容易理解含义</li>
<li>在函数定义中提供默认值，使代码简洁</li>
</ul>
<h2 id="20-用None和文档字符串描述含有动态默认值的参数"><a href="#20-用None和文档字符串描述含有动态默认值的参数" class="headerlink" title="20. 用None和文档字符串描述含有动态默认值的参数"></a>20. 用None和文档字符串描述含有动态默认值的参数</h2><p>参数默认值，只会在程序加载模块并读到本函数的定义时评估一次，对于{}或[]等动态的值，这可能会导致奇怪的行为</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">decode</span>(<span class="params">data, default=&#123;&#125;</span>):</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		<span class="keyword">return</span> json.loads(data)</span><br><span class="line">	<span class="keyword">except</span> ValueError:</span><br><span class="line">		<span class="keyword">return</span> default</span><br><span class="line"></span><br><span class="line">foo = decode(<span class="string">&#x27;bad data&#x27;</span>)</span><br><span class="line">foo[<span class="string">&#x27;stuff&#x27;</span>] = <span class="number">5</span></span><br><span class="line">bar = decode(<span class="string">&#x27;also bad&#x27;</span>)</span><br><span class="line">bar[<span class="string">&#x27;meep&#x27;</span>] = <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">Foo: &#123;<span class="string">&#x27;stuff&#x27;</span>: <span class="number">5</span>, <span class="string">&#x27;meep&#x27;</span>: <span class="number">1</span>&#125;</span><br><span class="line">Bar: &#123;<span class="string">&#x27;stuff&#x27;</span>: <span class="number">5</span>, <span class="string">&#x27;meep&#x27;</span>: <span class="number">1</span>&#125; <span class="comment"># Wrong</span></span><br></pre></td></tr></table></figure>

<p>解决方法是，把关键字参数默认设置为None，并在文档字符串中描述它的行为</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">decode</span>(<span class="params">data, default=<span class="literal">None</span></span>):</span><br><span class="line">	<span class="string">&quot;&quot;&quot; Load JSON data from a string</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	Args:</span></span><br><span class="line"><span class="string">		data: JSON data to decode</span></span><br><span class="line"><span class="string">		default: Value to return if decoding fails, Defaults to an empty dictionary</span></span><br><span class="line"><span class="string">	&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> default <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        default = &#123;&#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> json.loads(data)</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="keyword">return</span> default</span><br></pre></td></tr></table></figure>

<h2 id="21-用只能以关键字形式指定的参数来确保代码明晰"><a href="#21-用只能以关键字形式指定的参数来确保代码明晰" class="headerlink" title="21. 用只能以关键字形式指定的参数来确保代码明晰"></a>21. 用只能以关键字形式指定的参数来确保代码明晰</h2><h1 id="第3章-类与继承"><a href="#第3章-类与继承" class="headerlink" title="第3章 类与继承"></a>第3章 类与继承</h1><h2 id="22-尽量用辅助类维护程序状态，而不要用字典和元组"><a href="#22-尽量用辅助类维护程序状态，而不要用字典和元组" class="headerlink" title="22. 尽量用辅助类维护程序状态，而不要用字典和元组"></a>22. 尽量用辅助类维护程序状态，而不要用字典和元组</h2><ul>
<li>不要使用包含其他字典的字典，也不要使用过长的元组</li>
<li>如果容器中包含简单而又不可变的数据，可先使用namedtuple表示，后有需要再修改为类</li>
<li>保存内部状态的字典如果比较复杂，应该把代码拆解为辅助类</li>
</ul>
<h2 id="23-简单的接口应该接受函数，而不是类的实例"><a href="#23-简单的接口应该接受函数，而不是类的实例" class="headerlink" title="23. 简单的接口应该接受函数，而不是类的实例"></a>23. 简单的接口应该接受函数，而不是类的实例</h2><p>Python有许多内置API，允许调用者传入函数，以定制其行为，例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>names = [<span class="string">&#x27;Socrates&#x27;</span>, <span class="string">&#x27;Archimedes&#x27;</span>, <span class="string">&#x27;Plato&#x27;</span>, <span class="string">&#x27;Aristotle&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>names.sort(key=<span class="keyword">lambda</span> x: <span class="built_in">len</span>(x))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(names)</span><br><span class="line">[<span class="string">&#x27;Plato&#x27;</span>, <span class="string">&#x27;Socrates&#x27;</span>, <span class="string">&#x27;Aristotle&#x27;</span>, <span class="string">&#x27;Archimedes&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>其他编程语言可能用抽象类定义挂钩，然而在Python中，很多挂钩只是无状态函数，这些函数有明确参数和返回值。用函数做挂钩，比定义一个类要简单</p>
<h2 id="24-以-classmethod形式的多态去通用地构建对象"><a href="#24-以-classmethod形式的多态去通用地构建对象" class="headerlink" title="24. 以@classmethod形式的多态去通用地构建对象"></a>24. 以@classmethod形式的多态去通用地构建对象</h2><p>通过@classmethod机制，可以用一种与构造器相仿的方式构造类的对象</p>
<h2 id="25-用super初始化父类"><a href="#25-用super初始化父类" class="headerlink" title="25. 用super初始化父类"></a>25. 用super初始化父类</h2><ul>
<li>直接调用父类的__init__方法，在多重继承影响下，可能产生无法预知行为</li>
<li>总是应该使用内置的super函数初始化父类</li>
</ul>
<h2 id="26-只在使用Mix-in组件制作工具类时进行多重继承"><a href="#26-只在使用Mix-in组件制作工具类时进行多重继承" class="headerlink" title="26. 只在使用Mix-in组件制作工具类时进行多重继承"></a>26. 只在使用Mix-in组件制作工具类时进行多重继承</h2><h2 id="27-多用public属性，少用private属性"><a href="#27-多用public属性，少用private属性" class="headerlink" title="27. 多用public属性，少用private属性"></a>27. 多用public属性，少用private属性</h2><ul>
<li>Python编译器无法严格保证private字段私密性，用经典的格言来说：“we are all consenting adults here”，大家都认为开放比封闭更好</li>
<li>只有子类不受自己控制时，才可以考虑用private属性来避免名称冲突</li>
</ul>
<h2 id="28-继承collections-abc以实现自定义的容器类型"><a href="#28-继承collections-abc以实现自定义的容器类型" class="headerlink" title="28. 继承collections.abc以实现自定义的容器类型"></a>28. 继承collections.abc以实现自定义的容器类型</h2><p>编写自制容器类型，可以从内置collections.abc模块的抽象基类中继承。从这样的基类继承了子类后，如果忘记实现某个方法，那么collections.abc模块会指出这个错误：</p>
<pre><code>from collections.abc import Sequence
class BadType(Sequence):
    pass
foo = BadType()
&gt;&gt;&gt;
TypeError: Can&#39;t instantiate abstract class BadType with ...
</code></pre>
<h1 id="第4章-元素与属性"><a href="#第4章-元素与属性" class="headerlink" title="第4章 元素与属性"></a>第4章 元素与属性</h1><h2 id="29-用纯属性取代get和set方法"><a href="#29-用纯属性取代get和set方法" class="headerlink" title="29. 用纯属性取代get和set方法"></a>29. 用纯属性取代get和set方法</h2><p>从其他语言转入Python的开发者，可能会在类中明确实现getter, setter，但这种做法不像Python编程风格</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">OldResistor</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, ohms</span>):</span><br><span class="line">        <span class="variable language_">self</span>._ohms = ohms</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_ohms</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._ohms</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_ohms</span>(<span class="params">self, ohms</span>):</span><br><span class="line">        <span class="variable language_">self</span>._ohms = ohms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = OldResistor(<span class="number">50e3</span>)</span><br><span class="line"><span class="built_in">print</span>(obj.get_ohms())</span><br></pre></td></tr></table></figure>

<p>但是，对Python来说，不需要手工实现setter和getter，而是直接用public属性，这样原地自增操作变得清晰自然</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Resistor</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__init</span>(<span class="params">self, ohms</span>):</span><br><span class="line">		<span class="variable language_">self</span>.ohms = ohms</span><br><span class="line">r1 = Resistor(<span class="number">50e3</span>)</span><br><span class="line">r1.ohms += <span class="number">5e3</span></span><br></pre></td></tr></table></figure>

<h2 id="30-考虑用-property代替属性重构"><a href="#30-考虑用-property代替属性重构" class="headerlink" title="30. 考虑用@property代替属性重构"></a>30. 考虑用@property代替属性重构</h2><p>Python内置的@property装饰器负责把一个方法变成属性调用</p>
<p>例，使用@property既能检查参数，又可以用类似属性这样简单方法访问类的变量</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">score</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.score</span><br><span class="line"></span><br><span class="line"><span class="meta">    @score.setter</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">score</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(value, <span class="built_in">int</span>):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;score must be an int!&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> value &lt; <span class="number">0</span> <span class="keyword">or</span> value &gt; <span class="number">100</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;score must between 0 ~ 100&#x27;</span>)</span><br><span class="line">        <span class="variable language_">self</span>._score = value</span><br><span class="line"></span><br><span class="line">s = Student()</span><br><span class="line">s.score = <span class="number">60</span></span><br><span class="line">s.score = <span class="number">10000</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>python test.py</span><br><span class="line">ValueError: score must between <span class="number">0</span> ~ <span class="number">100</span></span><br></pre></td></tr></table></figure>

<h2 id="31-用描述符来改写需要复用的-property方法"><a href="#31-用描述符来改写需要复用的-property方法" class="headerlink" title="31. 用描述符来改写需要复用的@property方法"></a>31. 用描述符来改写需要复用的@property方法</h2><h2 id="32-用getattr-getattribute-setattr实现按需生成操作-惰性方式加载并保存对象属性）"><a href="#32-用getattr-getattribute-setattr实现按需生成操作-惰性方式加载并保存对象属性）" class="headerlink" title="32. 用getattr, getattribute, setattr实现按需生成操作 (惰性方式加载并保存对象属性）"></a>32. 用getattr, getattribute, setattr实现按需生成操作 (惰性方式加载并保存对象属性）</h2><ul>
<li>如果某个类定义了__getattr__，同时系统在该类对象实例字典中找不到待查属性，那么，系统就会调用这个方法</li>
<li>程序每次访问对象属性，Python系统会调用__getattribute__</li>
</ul>
<h2 id="33-用元类验证子类"><a href="#33-用元类验证子类" class="headerlink" title="33. 用元类验证子类"></a>33. 用元类验证子类</h2><h2 id="34-用元类注册子类"><a href="#34-用元类注册子类" class="headerlink" title="34. 用元类注册子类"></a>34. 用元类注册子类</h2><h1 id="第5章-并发及并行"><a href="#第5章-并发及并行" class="headerlink" title="第5章 并发及并行"></a>第5章 并发及并行</h1><h2 id="36-用subprocess模块管理子进程"><a href="#36-用subprocess模块管理子进程" class="headerlink" title="36. 用subprocess模块管理子进程"></a>36. 用subprocess模块管理子进程</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">proc = subprocess.Popen([<span class="string">&#x27;echo&#x27;</span>, <span class="string">&#x27;hello&#x27;</span>], stdout=subprocess.PIPE)</span><br><span class="line">out, err = proc.communicate()</span><br><span class="line"><span class="built_in">print</span>(out.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p>把子进程从父进程中剥离</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_sleep</span>(<span class="params">period</span>):</span><br><span class="line">    proc = subprocess.Popen([<span class="string">&#x27;sleep&#x27;</span>, <span class="built_in">str</span>(period)])</span><br><span class="line">    <span class="keyword">return</span> proc</span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line">procs = []</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    proc = run_sleep(<span class="number">0.1</span>)</span><br><span class="line">    procs.append(proc)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> proc <span class="keyword">in</span> procs:</span><br><span class="line">    proc.communicate()</span><br><span class="line">end = time.time()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Finished in %.3f seconds&#x27;</span> % (end - start))</span><br></pre></td></tr></table></figure>

<h2 id="37-可以用线程执行阻塞式IO，但不要用它做并行计算"><a href="#37-可以用线程执行阻塞式IO，但不要用它做并行计算" class="headerlink" title="37. 可以用线程执行阻塞式IO，但不要用它做并行计算"></a>37. 可以用线程执行阻塞式IO，但不要用它做并行计算</h2><ul>
<li>受到全局解释器锁（GIL）限制，多条Python线程不能在多个CPU核心上平行地执行字节码</li>
</ul>
<h2 id="38-在线程中使用Lock来防止数据竞争"><a href="#38-在线程中使用Lock来防止数据竞争" class="headerlink" title="38. 在线程中使用Lock来防止数据竞争"></a>38. 在线程中使用Lock来防止数据竞争</h2><ul>
<li>GIL不会保护开发者自己代码， 同一时刻固然只能有一个Python线程运行，但这个线程正在操作某个数据结构时，其他线程可能会打断它，也就是说Python解释器来执行两个连续字节码指令时，其他线程可能会中途插进来。</li>
</ul>
<p>threading.Lock类实现了互斥锁</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LockingCounter</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">		<span class="variable language_">self</span>.lock = Lock()</span><br><span class="line">		<span class="variable language_">self</span>.count = <span class="number">0</span></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">increment</span>(<span class="params">self, offset</span>):</span><br><span class="line">		<span class="keyword">with</span> <span class="variable language_">self</span>.lock:</span><br><span class="line">			<span class="variable language_">self</span>.count += offset</span><br></pre></td></tr></table></figure>

<h2 id="39-用Queue协调各线程之间的工作"><a href="#39-用Queue协调各线程之间的工作" class="headerlink" title="39. 用Queue协调各线程之间的工作"></a>39. 用Queue协调各线程之间的工作</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Queue</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">q = Queue.Queue(<span class="number">10</span>=</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">producer</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        q.put(i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">consumer</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        <span class="built_in">print</span>(q.get())</span><br><span class="line"></span><br><span class="line">threads = []</span><br><span class="line"></span><br><span class="line">t1 = threading.Thread(target=consumer)</span><br><span class="line">t2 = threading.Thread(target=producer)</span><br></pre></td></tr></table></figure>

<h2 id="40-考虑用协程并发地运行多个函数"><a href="#40-考虑用协程并发地运行多个函数" class="headerlink" title="40.考虑用协程并发地运行多个函数"></a>40.考虑用协程并发地运行多个函数</h2><ul>
<li>对于生成器的yield表达式来说，外部代码通过send方法传给生成器的那个值，就是该表达式所具备的值</li>
</ul>
<h2 id="x20-41-考虑用concurrent-futures实现平行计算"><a href="#x20-41-考虑用concurrent-futures实现平行计算" class="headerlink" title="&#x20;41. 考虑用concurrent.futures实现平行计算"></a>&#x20;41. 考虑用concurrent.futures实现平行计算</h2><ul>
<li>multiprocessing模块可用于实现平行计算，利用multiprocessing模块最恰当做法，是通过内置concurrent.futures模块及其ProcessPoolExecutor类使用它</li>
</ul>
<h1 id="第6章-内置模块"><a href="#第6章-内置模块" class="headerlink" title="第6章 内置模块"></a>第6章 内置模块</h1><h2 id="x20-42-用functools-wraps定义函数修饰器"><a href="#x20-42-用functools-wraps定义函数修饰器" class="headerlink" title="&#x20;42. 用functools.wraps定义函数修饰器"></a>&#x20;42. 用functools.wraps定义函数修饰器</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">trace</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        result = func(*args, **kwargs)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;%s(%r, %r) -&gt; %r&#x27;</span> % (func.__name__, args, kwargs, result))</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@trace</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fibonacci</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">if</span> n <span class="keyword">in</span> (<span class="number">0</span>, <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    <span class="keyword">return</span> fibonacci(n - <span class="number">2</span>) + fibonacci(n - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(fibonacci(<span class="number">3</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li>Python为修饰器提供专门语法，使得程序运行时，能用一个函数修改另一个函数</li>
</ul>
<h2 id="43-考虑以contextlib和with语句改写可复用的try-finally代码"><a href="#43-考虑以contextlib和with语句改写可复用的try-finally代码" class="headerlink" title="43. 考虑以contextlib和with语句改写可复用的try&#x2F;finally代码"></a>43. 考虑以contextlib和with语句改写可复用的try&#x2F;finally代码</h2><p>用with语句代替try… finally，例如</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/path/to/file&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">	f.read()</span><br></pre></td></tr></table></figure>

<h2 id="44-用copyreg实现可靠pickle操作"><a href="#44-用copyreg实现可靠pickle操作" class="headerlink" title="44. 用copyreg实现可靠pickle操作"></a>44. 用copyreg实现可靠pickle操作</h2><p>内置的pickle模块能够将Python对象字节序列转化为字节流，也能把字节反序列化成Python对象</p>
<h2 id="45-使用datatime模块处理本地时间而不是time"><a href="#45-使用datatime模块处理本地时间而不是time" class="headerlink" title="45. 使用datatime模块处理本地时间而不是time"></a>45. 使用datatime模块处理本地时间而不是time</h2><ul>
<li>不要用time模块在不同时区进行转换</li>
<li>开发者总是应该先把时间表示成UTC，然后对其转换，最后再转回本地时间</li>
</ul>
<h2 id="46-使用内置算法和数据结构"><a href="#46-使用内置算法和数据结构" class="headerlink" title="46. 使用内置算法和数据结构"></a>46. 使用内置算法和数据结构</h2><ul>
<li>双向队列 deque</li>
<li>有序字典 OrderedDict (按照键插入顺序，保留键值对在字典中次序）</li>
<li>优先级队列 heapq</li>
<li>二分查找 bisect</li>
<li>迭代器有关 itertools</li>
</ul>
<h2 id="47-重视精确度场合，应该使用decimal"><a href="#47-重视精确度场合，应该使用decimal" class="headerlink" title="47.重视精确度场合，应该使用decimal"></a>47.重视精确度场合，应该使用decimal</h2><p>Decimal类适合用在对精度要求高，对舍入行为要求严格的场合，例如：涉及货币计算的场合</p>
<h2 id="48-学会安装由Python开发者社区构建的模块-x20"><a href="#48-学会安装由Python开发者社区构建的模块-x20" class="headerlink" title="48. 学会安装由Python开发者社区构建的模块&#x20;"></a>48. 学会安装由Python开发者社区构建的模块&#x20;</h2><ul>
<li>PyPI (Python Package Index) 包含许多常用软件包， pip命令行工具可以从PyPI中安装软件包</li>
</ul>
<h1 id="第7章-协作开发"><a href="#第7章-协作开发" class="headerlink" title="第7章 协作开发"></a>第7章 协作开发</h1><h2 id="49-为每个函数、类和模块编写文档字符串"><a href="#49-为每个函数、类和模块编写文档字符串" class="headerlink" title="49. 为每个函数、类和模块编写文档字符串"></a>49. 为每个函数、类和模块编写文档字符串</h2><p><strong>为模块编写文档</strong></p>
<ul>
<li>每个模块应该有顶级的docstring</li>
<li>头一行文字，用一句话描述本模块用途，接着一段话包含一些细节信息，把与本模块操作相关内容，告诉模块使用者。</li>
<li>还可以在模块的dockstring中，强调本模块里比较重要类和函数，使开发者据此了解该模块用法</li>
</ul>
<p>举例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># words.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="string">&quot;&quot;&quot; Library for XXX...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Testing how words XXX...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Available functions:</span></span><br><span class="line"><span class="string"> - palindrome: Determine if a word ...</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>为类编写文档</strong></p>
<p>每一个类应该有docstring，写法与模块级的docstring大致相同，如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Player</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">	<span class="string">&quot;&quot;&quot;Represents a player of the game.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	Subclassses may override ...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	Public attributes:</span></span><br><span class="line"><span class="string">	- power: ...</span></span><br><span class="line"><span class="string">	- coins: ...</span></span><br><span class="line"><span class="string">	&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>为函数编写文档</strong></p>
<p>函数的docstring，第一行用一句话描述函数功能，接下来用一段话描述具体行为和函数参数。 若函数由返回值，应该在docstring中写明</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">find_anagrams</span>(<span class="params">word, dictionary</span>):</span><br><span class="line">	<span class="string">&quot;&quot;&quot;Find all anagrams for a word.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	This function only runs as fast as the test for membership in the dictionary container...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	Args:</span></span><br><span class="line"><span class="string">		word: String of the target word.</span></span><br><span class="line"><span class="string">		dictionary: Container with all strings that are known to be actual words.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	Returns:</span></span><br><span class="line"><span class="string">		List of anagrams that were found. Empty if none were found.</span></span><br></pre></td></tr></table></figure>
<p>作者的建议：</p>
<ul>
<li>如果函数没有参数，仅有一个简单返回值，那么只需一句话描述该函数就够了</li>
<li>如果函数没有返回值，不要在docstring里提及，不要出现return None这种说法</li>
<li>如果正常使用中不会抛异常，就不要在docstring提到异常</li>
<li>如果函数接收可变参数，应该在文档中描述*args, **kwargs用途</li>
<li>如果函数参数有默认值，应该指出这些默认值</li>
</ul>
<h2 id="50-用包安排模块，并提供稳固API"><a href="#50-用包安排模块，并提供稳固API" class="headerlink" title="50. 用包安排模块，并提供稳固API"></a>50. 用包安排模块，并提供稳固API</h2><p>在目录中放入名为__init__.py的空文件，就可以采用相对于该目录的路径，引入目录中其他Python文件，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">main.py</span><br><span class="line">mypackage/__init__.py</span><br><span class="line">mypackage/utils.py</span><br></pre></td></tr></table></figure>

<p>在main.py中引入utils模块</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"><span class="keyword">from</span> mypackage <span class="keyword">import</span> utils</span><br></pre></td></tr></table></figure>

<p><strong>as子句可以给引入当前作用域的属性重新起名，解决冲突</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> analysis.utils <span class="keyword">import</span> inspect <span class="keyword">as</span> analysis_inspect</span><br><span class="line"><span class="keyword">from</span> frontend.utils <span class="keyword">import</span> inspect <span class="keyword">as</span> frontend_inspect</span><br></pre></td></tr></table></figure>

<p>尽量不要使用import *语句，而是应该用from x import y，明确指出自己想要引入的名称</p>
<h2 id="51-为自编的模块定义根异常，以便将调用者与API隔离"><a href="#51-为自编的模块定义根异常，以便将调用者与API隔离" class="headerlink" title="51. 为自编的模块定义根异常，以便将调用者与API隔离"></a>51. 为自编的模块定义根异常，以便将调用者与API隔离</h2><h2 id="52-用适当方式打破循环依赖关系"><a href="#52-用适当方式打破循环依赖关系" class="headerlink" title="52. 用适当方式打破循环依赖关系"></a>52. 用适当方式打破循环依赖关系</h2><ul>
<li>如果两个模块必须相互调用对方，才能完成引入操作，就会出现循环依赖现象，这可能导致程序启动时崩溃</li>
<li>打破循环依赖关系最佳方案，是把导致两个模块互相依赖的那部分代码，重构为单独模块，并把它放在依赖树底部</li>
</ul>
<h2 id="53-用虚拟环境隔离项目，并重建其依赖关系"><a href="#53-用虚拟环境隔离项目，并重建其依赖关系" class="headerlink" title="53. 用虚拟环境隔离项目，并重建其依赖关系"></a>53. 用虚拟环境隔离项目，并重建其依赖关系</h2><h1 id="x20-第8章-部署"><a href="#x20-第8章-部署" class="headerlink" title="&#x20;第8章 部署"></a>&#x20;第8章 部署</h1><h2 id="54-考虑用模块级别代码配置不同部署环境-x20"><a href="#54-考虑用模块级别代码配置不同部署环境-x20" class="headerlink" title="54. 考虑用模块级别代码配置不同部署环境&#x20;"></a>54. 考虑用模块级别代码配置不同部署环境&#x20;</h2><h2 id="55-通过repr字符串输出调试信息"><a href="#55-通过repr字符串输出调试信息" class="headerlink" title="55. 通过repr字符串输出调试信息"></a>55. 通过repr字符串输出调试信息</h2><p>简单的print不能打印出值的类型信息，可以用repr获取类型信息</p>
<h2 id="56-用unittest测试全部代码"><a href="#56-用unittest测试全部代码" class="headerlink" title="56. 用unittest测试全部代码"></a>56. 用unittest测试全部代码</h2><h2 id="57-用pdb实现交互调试"><a href="#57-用pdb实现交互调试" class="headerlink" title="57. 用pdb实现交互调试"></a>57. 用pdb实现交互调试</h2><p><a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3/library/pdb.html">https://docs.python.org/zh-cn/3/library/pdb.html</a></p>
<h2 id="58-先分析性能，然后再优化"><a href="#58-先分析性能，然后再优化" class="headerlink" title="58. 先分析性能，然后再优化"></a>58. 先分析性能，然后再优化</h2><h2 id="59-用tracemalloc掌握内存使用和泄漏情况"><a href="#59-用tracemalloc掌握内存使用和泄漏情况" class="headerlink" title="59. 用tracemalloc掌握内存使用和泄漏情况"></a>59. 用tracemalloc掌握内存使用和泄漏情况</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://pcj600.github.io/2023/0812215151.html" data-id="cm2puzlxn006s4cvw46r0hly3" data-title="Effective Python 笔记" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2023/0815215310.html" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前一篇</strong>
      <div class="article-nav-title">
        
          Python的Lamdba函数是什么，应用场景是什么?
        
      </div>
    </a>
  
  
    <a href="/2023/0719214818.html" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">后一篇</strong>
      <div class="article-nav-title">流畅的Python 笔记</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Assembly/">Assembly</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/C/">C</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CMake/">CMake</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CSAPP/">CSAPP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Django/">Django</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/GDB/">GDB</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/LeetCode/">LeetCode</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Network/">Network</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/RPM/">RPM</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/">Redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Shell/">Shell</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Squid/">Squid</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/VMware/">VMware</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Win/">Win</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ansible/">ansible</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/awk/">awk</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/curl/">curl</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/draft/">draft</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/interview/">interview</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/investment/">investment</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iptables/">iptables</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/">k8s</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/systemd/">systemd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/troubleshooting/">troubleshooting</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/wget/">wget</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Assembly/" rel="tag">Assembly</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CLISH/" rel="tag">CLISH</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CMake/" rel="tag">CMake</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSAPP/" rel="tag">CSAPP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Django/" rel="tag">Django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GDB/" rel="tag">GDB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GRUB/" rel="tag">GRUB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/" rel="tag">HTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LeetCode/" rel="tag">LeetCode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Network/" rel="tag">Network</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RPM/" rel="tag">RPM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/" rel="tag">Shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Squid/" rel="tag">Squid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Traceroute/" rel="tag">Traceroute</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VMware/" rel="tag">VMware</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Win/" rel="tag">Win</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ansible/" rel="tag">ansible</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/awk/" rel="tag">awk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/chronyd/" rel="tag">chronyd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/crontab/" rel="tag">crontab</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/curl/" rel="tag">curl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/frontend/" rel="tag">frontend</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gcc/" rel="tag">gcc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/interview/" rel="tag">interview</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/investment/" rel="tag">investment</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iptables/" rel="tag">iptables</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/other/" rel="tag">other</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/" rel="tag">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/systemd/" rel="tag">systemd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tar/" rel="tag">tar</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/troubleshooting/" rel="tag">troubleshooting</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wget/" rel="tag">wget</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Assembly/" style="font-size: 11.11px;">Assembly</a> <a href="/tags/C/" style="font-size: 13.33px;">C</a> <a href="/tags/CLISH/" style="font-size: 10px;">CLISH</a> <a href="/tags/CMake/" style="font-size: 10px;">CMake</a> <a href="/tags/CSAPP/" style="font-size: 13.33px;">CSAPP</a> <a href="/tags/Django/" style="font-size: 12.22px;">Django</a> <a href="/tags/Docker/" style="font-size: 14.44px;">Docker</a> <a href="/tags/GDB/" style="font-size: 13.33px;">GDB</a> <a href="/tags/GRUB/" style="font-size: 10px;">GRUB</a> <a href="/tags/Git/" style="font-size: 13.33px;">Git</a> <a href="/tags/HTML/" style="font-size: 10px;">HTML</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/LeetCode/" style="font-size: 13.33px;">LeetCode</a> <a href="/tags/Linux/" style="font-size: 20px;">Linux</a> <a href="/tags/MySQL/" style="font-size: 13.33px;">MySQL</a> <a href="/tags/Network/" style="font-size: 13.33px;">Network</a> <a href="/tags/Python/" style="font-size: 16.67px;">Python</a> <a href="/tags/RPM/" style="font-size: 12.22px;">RPM</a> <a href="/tags/Redis/" style="font-size: 17.78px;">Redis</a> <a href="/tags/Shell/" style="font-size: 11.11px;">Shell</a> <a href="/tags/Squid/" style="font-size: 14.44px;">Squid</a> <a href="/tags/Traceroute/" style="font-size: 10px;">Traceroute</a> <a href="/tags/VMware/" style="font-size: 12.22px;">VMware</a> <a href="/tags/Win/" style="font-size: 12.22px;">Win</a> <a href="/tags/ansible/" style="font-size: 10px;">ansible</a> <a href="/tags/awk/" style="font-size: 10px;">awk</a> <a href="/tags/chronyd/" style="font-size: 10px;">chronyd</a> <a href="/tags/crontab/" style="font-size: 10px;">crontab</a> <a href="/tags/curl/" style="font-size: 10px;">curl</a> <a href="/tags/frontend/" style="font-size: 10px;">frontend</a> <a href="/tags/gcc/" style="font-size: 10px;">gcc</a> <a href="/tags/interview/" style="font-size: 10px;">interview</a> <a href="/tags/investment/" style="font-size: 17.78px;">investment</a> <a href="/tags/iptables/" style="font-size: 12.22px;">iptables</a> <a href="/tags/k8s/" style="font-size: 15.56px;">k8s</a> <a href="/tags/other/" style="font-size: 10px;">other</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/systemd/" style="font-size: 12.22px;">systemd</a> <a href="/tags/tar/" style="font-size: 10px;">tar</a> <a href="/tags/troubleshooting/" style="font-size: 18.89px;">troubleshooting</a> <a href="/tags/wget/" style="font-size: 10px;">wget</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/10/">十月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">九月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">八月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">七月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/06/">六月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">五月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">四月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">三月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">二月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">十二月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">十一月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">八月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">七月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">六月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">五月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">四月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">三月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">二月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">十一月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">六月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">三月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">一月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">十二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">十一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">六月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/1026143114.html">Hexo搭建博客问题记录</a>
          </li>
        
          <li>
            <a href="/2024/1026131638.html">华宝添益(511990)折价套利记录</a>
          </li>
        
          <li>
            <a href="/2024/1026131259.html">chronyd配置了local的NTP server后, NTP报文出现public ip的问题</a>
          </li>
        
          <li>
            <a href="/2024/1017202436.html">MySQL8.0以上版本如何重置密码</a>
          </li>
        
          <li>
            <a href="/2024/1017195632.html">在Rocky Linux上安装Docker</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 PC<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>