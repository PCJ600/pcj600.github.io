<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="VLyEpKy1Jq3gcpFmB3W8Ql0f4f-G35UyYi1NJ8Towq0">
  <meta name="baidu-site-verification" content="codeva-dRzuqywF6U">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"pcj600.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="前言不错的Python进阶书。写这个笔记的目的是，把书中提到的编写高质量Python的59个方法的要点记录下来，便于今后的工作中查阅 第1章：用Pythonic方式来思考">
<meta property="og:type" content="article">
<meta property="og:title" content="Effective Python 笔记">
<meta property="og:url" content="https://pcj600.github.io/2023/0812215151.html">
<meta property="og:site_name" content="PC&#39;s Blog">
<meta property="og:description" content="前言不错的Python进阶书。写这个笔记的目的是，把书中提到的编写高质量Python的59个方法的要点记录下来，便于今后的工作中查阅 第1章：用Pythonic方式来思考">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-08-12T13:51:51.000Z">
<meta property="article:modified_time" content="2024-08-18T13:52:41.572Z">
<meta property="article:author" content="PC">
<meta property="article:tag" content="Python">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://pcj600.github.io/2023/0812215151.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Effective Python 笔记 | PC's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">PC's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">38</span></a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">50</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">180</span></a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://pcj600.github.io/2023/0812215151.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="PC">
      <meta itemprop="description" content="PC的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PC's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Effective Python 笔记
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-08-12 21:51:51" itemprop="dateCreated datePublished" datetime="2023-08-12T21:51:51+08:00">2023-08-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>15k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>13 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1><span id="前言">前言</span></h1><p>不错的Python进阶书。写这个笔记的目的是，把书中提到的编写高质量Python的59个方法的要点记录下来，便于今后的工作中查阅</p>
<h1><span id="第1章用pythonic方式来思考">第1章：用Pythonic方式来思考</span></h1><span id="more"></span>

<h2><span id="x201-用pythonic方式来思考">&#x20;1. 用Pythonic方式来思考</span></h2><p>python之禅 —— <code>import this</code></p>
<h2><span id="x202-遵循pep8风格">&#x20;2. 遵循PEP8风格</span></h2><p>PEP8 —— Python Enhancement Proposal #8</p>
<p>空白：</p>
<ul>
<li>使用空格而不是tab表示缩进</li>
<li>和语法相关每一层缩进用4个空格</li>
<li>每行字符数不超过79</li>
<li>占据多行表达式，除首行外其余各行应在通常缩进级别上加4空格</li>
<li>函数与类之间两个空行隔开</li>
<li>同一个类中，各方法一个空行隔开</li>
<li>使用下标获取元素，不要在两旁加空格</li>
<li>为变量赋值，赋值符号左侧和右侧各自写一个空格，不要在两旁添加空格</li>
</ul>
<p>命名：</p>
<ul>
<li>函数、变量、属性用小写，各单词以下划线连接</li>
<li>受保护实例属性，以单下划线开头</li>
<li>私有实例属性：以两个下划线开头</li>
<li>类以异常，应每个单词以大写形式命名，如CapitalizedWord</li>
<li>模块级别常量，应全部采用大写，各单词以下划线相连，如ALL_CAPS</li>
<li>类中实例方法，应该把首个参数命名为self，以表示对象自身</li>
<li>类方法首个参数，应该命名为cls，以表示类自身</li>
</ul>
<p>表达式和语句：</p>
<ul>
<li>采用内联形式否定词，而不是把否定词放在整个表达式前面，例如写if a is not b 而不是 if not a is b</li>
<li>不要通过测长度方法判断list是否为空，应采用if not list，空值会自动评估为False</li>
<li>import语句总应放在文件开头</li>
<li>引入模块时总应使用绝对名称，不应根据当前模块路径使用相对名称，例如引入bar包中的foo模块，应完整写出from bar import foo，不应该简写import foo</li>
<li>文件中import语句应按顺序划三部分，分别表示标准库模块，第三方模块，自用模块，各部分中的import语句应按模块的字母顺序排列</li>
</ul>
<h2><span id="3-了解bytes-str-unicode区别">3. 了解bytes, str, unicode区别</span></h2><ul>
<li>Python3中，bytes是一个包含8位置的序列，str是一种包含unicode字符序列</li>
</ul>
<h2><span id="4-用辅助函数取代复杂表达式">4. 用辅助函数取代复杂表达式</span></h2><p>开发者容易过度运用Python语法特性，写出特别复杂难以理解的单行表达式。<strong>这种情况需要把复杂表达式移到辅助函数</strong></p>
<h2><span id="5-了解切割序列的方法">5. 了解切割序列的方法</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;h&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[:<span class="number">4</span>]</span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[<span class="number">5</span>:]</span><br><span class="line">[<span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;h&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[-<span class="number">2</span>:]</span><br><span class="line">[<span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;h&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[<span class="number">2</span>:-<span class="number">3</span>]</span><br><span class="line">[<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[:]</span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;h&#x27;</span>]</span><br><span class="line">a[<span class="number">2</span>:<span class="number">6</span>] = [<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;o&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;h&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h2><span id="6-单次切片操作内不要同时指定start-end-stride">6. 单次切片操作内，不要同时指定start, end, stride</span></h2><p>除了基本切片操作，Python还提供了somelist[start:end:stride]形式写法，以实现步进式切割，就是从每n个元素里取1个出来</p>
<p>既有start, end，又有stride的切割操作，可能令人费解，考虑拆解两条语句，其中一条做范围切割，另一条做步进切割，如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b = a[::<span class="number">2</span>]    <span class="comment"># [&#x27;a&#x27;, &#x27;c&#x27;, &#x27;e&#x27;, &#x27;g&#x27;]</span></span><br><span class="line">c = b[<span class="number">1</span>:-<span class="number">1</span>]   <span class="comment"># [&#x27;c&#x27;, &#x27;e&#x27;]</span></span><br></pre></td></tr></table></figure>

<h2><span id="x207-用列表推导取代map-filter">&#x20;7. 用列表推导取代map, filter</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">squares = [ x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> a ]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(squares)</span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>]</span><br><span class="line">或者<span class="built_in">map</span>, <span class="built_in">filter</span></span><br><span class="line">squares = <span class="built_in">map</span>(<span class="keyword">lambda</span> x: x ** <span class="number">2</span>, a)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(squares)</span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>]</span><br></pre></td></tr></table></figure>

<h2><span id="8-不要使用含有两个以上表达式的列表推导">8. 不要使用含有两个以上表达式的列表推导</span></h2><p>例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">my_lists = [</span><br><span class="line">    [[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>], [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]],</span><br><span class="line">]</span><br><span class="line">flat = [x <span class="keyword">for</span> sublist1 <span class="keyword">in</span> my_lists</span><br><span class="line">		  <span class="keyword">for</span> sublist2 <span class="keyword">in</span> sublist1</span><br><span class="line">		  <span class="keyword">for</span> x <span class="keyword">in</span> sublist2]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以看出，列表推导写法不够简洁，改用普通循环语句实现相同效果</span></span><br><span class="line">flat = []</span><br><span class="line"><span class="keyword">for</span> sublist1 <span class="keyword">in</span> my_lists:</span><br><span class="line">	<span class="keyword">for</span> sublist2 <span class="keyword">in</span> sublist1:</span><br><span class="line">		flat.extend(sublist2)</span><br></pre></td></tr></table></figure>

<h2><span id="9-用生成器表达式改写数据量较大的列表推导">9. 用生成器表达式改写数据量较大的列表推导</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">it = (<span class="built_in">len</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">open</span>(<span class="string">&#x27;file.txt&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(it)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">generator obj at XXX</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(it))</span><br></pre></td></tr></table></figure>

<h2><span id="10-尽量用enumerate取代range">10. 尽量用enumerate取代range</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flavor_list = [<span class="string">&#x27;vanilla&#x27;</span>, <span class="string">&#x27;chocolate&#x27;</span>, <span class="string">&#x27;pecan&#x27;</span>, <span class="string">&#x27;strawberry&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> i, flavor <span class="keyword">in</span> <span class="built_in">enumerate</span>(flavor_list):</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;%d: %s&#x27;</span> % (i + <span class="number">1</span>, flavor))</span><br></pre></td></tr></table></figure>

<p>还可以直接指定enumerate函数开始计数时所用值，这样能把代码写的更短</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i, flavor <span class="keyword">in</span> <span class="built_in">enumerate</span>(flavor_list, <span class="number">1</span>):</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;%d: %s&#x27;</span> % (i, flavor))</span><br></pre></td></tr></table></figure>

<h2><span id="11-用zip函数同时遍历两个迭代器">11. 用zip函数同时遍历两个迭代器</span></h2><p>使用range或enumerate方法的代码不够简洁</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">names = [<span class="string">&#x27;Cecilia&#x27;</span>, <span class="string">&#x27;Lise&#x27;</span>, <span class="string">&#x27;Marie&#x27;</span>]</span><br><span class="line">letters = [ <span class="built_in">len</span>(s) <span class="keyword">for</span> s <span class="keyword">in</span> names]</span><br><span class="line"></span><br><span class="line">longest_name = <span class="literal">None</span></span><br><span class="line">max_letters = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i, name <span class="keyword">in</span> <span class="built_in">enumerate</span>(names):</span><br><span class="line">    <span class="keyword">if</span> letters[i] &gt; max_letters:</span><br><span class="line">        max_letters = letters[i]</span><br><span class="line">        longest_name = name</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;longest_name: &#x27;</span>, longest_name)</span><br></pre></td></tr></table></figure>

<p>改用内置zip方法，使代码更清晰</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">names = [<span class="string">&#x27;Cecilia&#x27;</span>, <span class="string">&#x27;Lise&#x27;</span>, <span class="string">&#x27;Marie&#x27;</span>]</span><br><span class="line">letters = [ <span class="built_in">len</span>(s) <span class="keyword">for</span> s <span class="keyword">in</span> names]</span><br><span class="line"></span><br><span class="line">longest_name = <span class="literal">None</span></span><br><span class="line">max_letters = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> name, count <span class="keyword">in</span> <span class="built_in">zip</span>(names, letters):</span><br><span class="line">    <span class="keyword">if</span> count &gt; max_letters:</span><br><span class="line">        longest_name = name</span><br><span class="line">        max_letters = count</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;longest_name: &#x27;</span>, longest_name)</span><br></pre></td></tr></table></figure>

<p>注意点：</p>
<ul>
<li>Python2中zip不是生成器，而是会把开发者提供那些迭代器都平行遍历一次，可能占用大量内存导致程序崩溃</li>
<li>如果输入迭代器长度不同，zip会提前终止，将导致意外结果</li>
</ul>
<h2><span id="12-不要在for和while循环后写else块">12. 不要在for和while循环后写else块</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;Loop %d&#x27;</span> % i)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;Else block!&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>else块会在整个循环执行完之后立刻运行</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Loop %d&#x27;</span> % i)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Else block!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">$ python test.py</span><br><span class="line">Loop <span class="number">0</span></span><br><span class="line">Loop <span class="number">1</span></span><br><span class="line">Loop <span class="number">2</span></span><br><span class="line">Else block!</span><br></pre></td></tr></table></figure>

<ul>
<li>循环里用break提前跳出，会导致else块不执行</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;Loop %d&#x27;</span> % i)</span><br><span class="line">	<span class="keyword">if</span> i == <span class="number">1</span>:</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;Else block!&#x27;</span>)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">Loop <span class="number">0</span></span><br><span class="line">Loop <span class="number">1</span></span><br></pre></td></tr></table></figure>

<ul>
<li>如果for循环遍历序列是空的，就会立刻执行else块</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> []:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;Never runs&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;For Else block!&#x27;</span>)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">For Else block!</span><br></pre></td></tr></table></figure>

<p>要点：不要在循环后使用else块，这种写法即不直观，又容易让人误解</p>
<h2><span id="13-合理利用tryx2fexceptx2felsex2ffinally结构中每个代码块">13. 合理利用try&#x2F;except&#x2F;else&#x2F;finally结构中每个代码块</span></h2><ul>
<li>无论try是否异常，都可利用try&#x2F;finally复合语句中finally块执行清理工作</li>
<li>else块可用来缩减try代码量，并把没有发生异常所要执行的语句与try&#x2F;except分开</li>
<li>顺利运行try块后，若想使某些操作能在finaly块的清理代码前执行，可将这些操作写到else</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">UNDEFINED = <span class="built_in">object</span>()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">divide_json</span>(<span class="params">path</span>):</span><br><span class="line">	handle = <span class="built_in">open</span>(path, <span class="string">&#x27;r+&#x27;</span>)</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		data = handle.read()</span><br><span class="line">		op = json.loads(data)</span><br><span class="line">		value = (op[<span class="string">&#x27;numerator&#x27;</span>]/op[<span class="string">&#x27;denominator&#x27;</span>])</span><br><span class="line">	<span class="keyword">except</span> ZeroDivisionError es e:</span><br><span class="line">		<span class="keyword">return</span> UNDEFINED</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">	    op[<span class="string">&#x27;result&#x27;</span>] = value</span><br><span class="line">	    result = json.dumps(op)</span><br><span class="line">	    handle.seek(<span class="number">0</span>)</span><br><span class="line">	    handle.write(result)</span><br><span class="line">	    <span class="keyword">return</span> value</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">	    handle.close()</span><br></pre></td></tr></table></figure>

<h1><span id="第2章-函数">第2章 函数</span></h1><h2><span id="14-尽量用异常来表示特殊情况而不返回nones">14. 尽量用异常来表示特殊情况，而不返回Nones</span></h2><p>例：令函数返回None，可能会使调用该函数人犯错</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">divide</span>(<span class="params">a, b</span>):</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		<span class="keyword">return</span> a / b</span><br><span class="line">	<span class="keyword">except</span> ZeroDivisionError:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">x,y = <span class="number">0</span>, <span class="number">5</span></span><br><span class="line">result = divide(x, y)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> result:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;Invaid inputs&#x27;</span>) <span class="comment"># This is WRONG !</span></span><br></pre></td></tr></table></figure>

<p>改进方法一： 把返回值拆两部分，例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">divide</span>(<span class="params">a, b</span>):</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">True</span>, a / b</span><br><span class="line">	<span class="keyword">except</span> ZeroDivisionError:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">False</span>, <span class="literal">None</span></span><br></pre></td></tr></table></figure>

<p>改进方法二：给上一级抛异常</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">divide</span>(<span class="params">a, b</span>):</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		<span class="keyword">return</span> a / b:</span><br><span class="line">	<span class="keyword">except</span> ZeroDivisionError <span class="keyword">as</span> e:</span><br><span class="line">		<span class="keyword">raise</span> ValueError(<span class="string">&#x27;Invalid inputs&#x27;</span>) <span class="keyword">from</span> e</span><br></pre></td></tr></table></figure>

<h2><span id="15-了解如何在闭包里使用外围作用域中的变量">15. 了解如何在闭包里使用外围作用域中的变量</span></h2><p>使用nonlocal获取闭包内的数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">sort_priority3</span>(<span class="params">numbers, group</span>):</span><br><span class="line">	found = <span class="literal">False</span></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">helper</span>(<span class="params">x</span>):</span><br><span class="line">		<span class="keyword">nonlocal</span> found</span><br><span class="line">		<span class="keyword">if</span> x <span class="keyword">in</span> group:</span><br><span class="line">			found = <span class="literal">True</span></span><br><span class="line">			<span class="keyword">return</span> (<span class="number">0</span>, x)</span><br><span class="line">		<span class="keyword">return</span> (<span class="number">1</span>, x)</span><br><span class="line">	numbers.sort(key=helper)</span><br><span class="line">	<span class="keyword">return</span> found</span><br></pre></td></tr></table></figure>

<h2><span id="16-用生成器改写直接返回列表函数">16. 用生成器改写直接返回列表函数</span></h2><p>这种写法的问题是，返回前要把所有结果放在列表里，如果输入量非常大，程序可能耗尽内存崩溃</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">index_words</span>(<span class="params">text</span>):</span><br><span class="line">	result = []</span><br><span class="line">	<span class="keyword">if</span> text:</span><br><span class="line">		result.append(<span class="number">0</span>)</span><br><span class="line">	<span class="keyword">for</span> index, letter <span class="keyword">in</span> <span class="built_in">enumerate</span>(text):</span><br><span class="line">		<span class="keyword">if</span> letter == <span class="string">&#x27; &#x27;</span>:</span><br><span class="line">			result.append(index + <span class="number">1</span>)</span><br><span class="line">	<span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">address = <span class="string">&#x27;Four score and seven years ago...&#x27;</span></span><br><span class="line">result = index_words(address)</span><br><span class="line"><span class="built_in">print</span>(result[:<span class="number">3</span>])</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">[<span class="number">0</span>, <span class="number">5</span>, <span class="number">11</span>]</span><br></pre></td></tr></table></figure>

<p>用生成器改写会更好，生成器用yield表达式函数，调用生成器函数时，不会真的运行，而是返回迭代器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">index_word_iter</span>(<span class="params">text</span>):</span><br><span class="line">	<span class="keyword">if</span> text:</span><br><span class="line">		<span class="keyword">yield</span> <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> index, letter <span class="keyword">in</span> <span class="built_in">enumerate</span>(text):</span><br><span class="line">		<span class="keyword">if</span> letter == <span class="string">&#x27; &#x27;</span>:</span><br><span class="line">			<span class="keyword">yield</span> index + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">address = <span class="string">&#x27;Four score and seven years ago...&#x27;</span></span><br><span class="line">result = <span class="built_in">list</span>(index_words_iter(address))</span><br><span class="line">[<span class="number">0</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">21</span>, <span class="number">27</span>]</span><br></pre></td></tr></table></figure>

<h2><span id="17-在参数上迭代时多加小心">17. 在参数上迭代时，多加小心</span></h2><p>函数在输入参数上多次迭代时要当心，如果参数是迭代器，可能导致奇怪的行为并错失某些值</p>
<h2><span id="18-用数量可变位置参数减少视觉杂讯-visual-noise">18. 用数量可变位置参数减少视觉杂讯 (visual noise)</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">log</span>(<span class="params">message, *values</span>):</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> values:</span><br><span class="line">		<span class="built_in">print</span>(message)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		values_str = <span class="string">&#x27;, &#x27;</span>.join(<span class="built_in">str</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> values)</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&#x27;%s: %s&#x27;</span> % (message, values_str))</span><br><span class="line"></span><br><span class="line">log(<span class="string">&#x27;My numbers are&#x27;</span>, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">log(<span class="string">&#x27;Hi there&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>要点：</p>
<ul>
<li>def语句中使用*args, 即可令函数接收数量可变的位置参数</li>
<li>在已经接收*args参数的函数上继续添加位置参数，可能产生难以排查的BUG</li>
</ul>
<h2><span id="19-用关键字参数表达可选的行为">19. 用关键字参数表达可选的行为</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">remainder</span>(<span class="params">number, divisor</span>):</span><br><span class="line">	<span class="keyword">return</span> number % divisor</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>下面这些调用，都是等效的</span><br><span class="line">remainder(<span class="number">20</span>, <span class="number">7</span>)</span><br><span class="line">remainder(<span class="number">20</span>, divisor=<span class="number">7</span>)</span><br><span class="line">remainder(number=<span class="number">20</span>, divisor=<span class="number">7</span>)</span><br><span class="line">remainder(ivisor=<span class="number">7</span>, number=<span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<p>灵活使用关键字参数，提供如下好处：</p>
<ul>
<li>更容易理解含义</li>
<li>在函数定义中提供默认值，使代码简洁</li>
</ul>
<h2><span id="20-用none和文档字符串描述含有动态默认值的参数">20. 用None和文档字符串描述含有动态默认值的参数</span></h2><p>参数默认值，只会在程序加载模块并读到本函数的定义时评估一次，对于{}或[]等动态的值，这可能会导致奇怪的行为</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">decode</span>(<span class="params">data, default=&#123;&#125;</span>):</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		<span class="keyword">return</span> json.loads(data)</span><br><span class="line">	<span class="keyword">except</span> ValueError:</span><br><span class="line">		<span class="keyword">return</span> default</span><br><span class="line"></span><br><span class="line">foo = decode(<span class="string">&#x27;bad data&#x27;</span>)</span><br><span class="line">foo[<span class="string">&#x27;stuff&#x27;</span>] = <span class="number">5</span></span><br><span class="line">bar = decode(<span class="string">&#x27;also bad&#x27;</span>)</span><br><span class="line">bar[<span class="string">&#x27;meep&#x27;</span>] = <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">Foo: &#123;<span class="string">&#x27;stuff&#x27;</span>: <span class="number">5</span>, <span class="string">&#x27;meep&#x27;</span>: <span class="number">1</span>&#125;</span><br><span class="line">Bar: &#123;<span class="string">&#x27;stuff&#x27;</span>: <span class="number">5</span>, <span class="string">&#x27;meep&#x27;</span>: <span class="number">1</span>&#125; <span class="comment"># Wrong</span></span><br></pre></td></tr></table></figure>

<p>解决方法是，把关键字参数默认设置为None，并在文档字符串中描述它的行为</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">decode</span>(<span class="params">data, default=<span class="literal">None</span></span>):</span><br><span class="line">	<span class="string">&quot;&quot;&quot; Load JSON data from a string</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	Args:</span></span><br><span class="line"><span class="string">		data: JSON data to decode</span></span><br><span class="line"><span class="string">		default: Value to return if decoding fails, Defaults to an empty dictionary</span></span><br><span class="line"><span class="string">	&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> default <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        default = &#123;&#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> json.loads(data)</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="keyword">return</span> default</span><br></pre></td></tr></table></figure>

<h2><span id="21-用只能以关键字形式指定的参数来确保代码明晰">21. 用只能以关键字形式指定的参数来确保代码明晰</span></h2><h1><span id="第3章-类与继承">第3章 类与继承</span></h1><h2><span id="22-尽量用辅助类维护程序状态而不要用字典和元组">22. 尽量用辅助类维护程序状态，而不要用字典和元组</span></h2><ul>
<li>不要使用包含其他字典的字典，也不要使用过长的元组</li>
<li>如果容器中包含简单而又不可变的数据，可先使用namedtuple表示，后有需要再修改为类</li>
<li>保存内部状态的字典如果比较复杂，应该把代码拆解为辅助类</li>
</ul>
<h2><span id="23-简单的接口应该接受函数而不是类的实例">23. 简单的接口应该接受函数，而不是类的实例</span></h2><p>Python有许多内置API，允许调用者传入函数，以定制其行为，例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>names = [<span class="string">&#x27;Socrates&#x27;</span>, <span class="string">&#x27;Archimedes&#x27;</span>, <span class="string">&#x27;Plato&#x27;</span>, <span class="string">&#x27;Aristotle&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>names.sort(key=<span class="keyword">lambda</span> x: <span class="built_in">len</span>(x))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(names)</span><br><span class="line">[<span class="string">&#x27;Plato&#x27;</span>, <span class="string">&#x27;Socrates&#x27;</span>, <span class="string">&#x27;Aristotle&#x27;</span>, <span class="string">&#x27;Archimedes&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>其他编程语言可能用抽象类定义挂钩，然而在Python中，很多挂钩只是无状态函数，这些函数有明确参数和返回值。用函数做挂钩，比定义一个类要简单</p>
<h2><span id="24-以classmethod形式的多态去通用地构建对象">24. 以@classmethod形式的多态去通用地构建对象</span></h2><p>通过@classmethod机制，可以用一种与构造器相仿的方式构造类的对象</p>
<h2><span id="25-用super初始化父类">25. 用super初始化父类</span></h2><ul>
<li>直接调用父类的__init__方法，在多重继承影响下，可能产生无法预知行为</li>
<li>总是应该使用内置的super函数初始化父类</li>
</ul>
<h2><span id="26-只在使用mix-in组件制作工具类时进行多重继承">26. 只在使用Mix-in组件制作工具类时进行多重继承</span></h2><h2><span id="27-多用public属性少用private属性">27. 多用public属性，少用private属性</span></h2><ul>
<li>Python编译器无法严格保证private字段私密性，用经典的格言来说：“we are all consenting adults here”，大家都认为开放比封闭更好</li>
<li>只有子类不受自己控制时，才可以考虑用private属性来避免名称冲突</li>
</ul>
<h2><span id="28-继承collectionsabc以实现自定义的容器类型">28. 继承collections.abc以实现自定义的容器类型</span></h2><p>编写自制容器类型，可以从内置collections.abc模块的抽象基类中继承。从这样的基类继承了子类后，如果忘记实现某个方法，那么collections.abc模块会指出这个错误：</p>
<pre><code>from collections.abc import Sequence
class BadType(Sequence):
    pass
foo = BadType()
&gt;&gt;&gt;
TypeError: Can&#39;t instantiate abstract class BadType with ...
</code></pre>
<h1><span id="第4章-元素与属性">第4章 元素与属性</span></h1><h2><span id="29-用纯属性取代get和set方法">29. 用纯属性取代get和set方法</span></h2><p>从其他语言转入Python的开发者，可能会在类中明确实现getter, setter，但这种做法不像Python编程风格</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">OldResistor</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, ohms</span>):</span><br><span class="line">        <span class="variable language_">self</span>._ohms = ohms</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_ohms</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._ohms</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_ohms</span>(<span class="params">self, ohms</span>):</span><br><span class="line">        <span class="variable language_">self</span>._ohms = ohms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = OldResistor(<span class="number">50e3</span>)</span><br><span class="line"><span class="built_in">print</span>(obj.get_ohms())</span><br></pre></td></tr></table></figure>

<p>但是，对Python来说，不需要手工实现setter和getter，而是直接用public属性，这样原地自增操作变得清晰自然</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Resistor</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__init</span>(<span class="params">self, ohms</span>):</span><br><span class="line">		<span class="variable language_">self</span>.ohms = ohms</span><br><span class="line">r1 = Resistor(<span class="number">50e3</span>)</span><br><span class="line">r1.ohms += <span class="number">5e3</span></span><br></pre></td></tr></table></figure>

<h2><span id="30-考虑用property代替属性重构">30. 考虑用@property代替属性重构</span></h2><p>Python内置的@property装饰器负责把一个方法变成属性调用</p>
<p>例，使用@property既能检查参数，又可以用类似属性这样简单方法访问类的变量</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">score</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.score</span><br><span class="line"></span><br><span class="line"><span class="meta">    @score.setter</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">score</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(value, <span class="built_in">int</span>):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;score must be an int!&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> value &lt; <span class="number">0</span> <span class="keyword">or</span> value &gt; <span class="number">100</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;score must between 0 ~ 100&#x27;</span>)</span><br><span class="line">        <span class="variable language_">self</span>._score = value</span><br><span class="line"></span><br><span class="line">s = Student()</span><br><span class="line">s.score = <span class="number">60</span></span><br><span class="line">s.score = <span class="number">10000</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>python test.py</span><br><span class="line">ValueError: score must between <span class="number">0</span> ~ <span class="number">100</span></span><br></pre></td></tr></table></figure>

<h2><span id="31-用描述符来改写需要复用的property方法">31. 用描述符来改写需要复用的@property方法</span></h2><h2><span id="32-用getattr-getattribute-setattr实现按需生成操作-惰性方式加载并保存对象属性">32. 用getattr, getattribute, setattr实现按需生成操作 (惰性方式加载并保存对象属性）</span></h2><ul>
<li>如果某个类定义了__getattr__，同时系统在该类对象实例字典中找不到待查属性，那么，系统就会调用这个方法</li>
<li>程序每次访问对象属性，Python系统会调用__getattribute__</li>
</ul>
<h2><span id="33-用元类验证子类">33. 用元类验证子类</span></h2><h2><span id="34-用元类注册子类">34. 用元类注册子类</span></h2><h1><span id="第5章-并发及并行">第5章 并发及并行</span></h1><h2><span id="36-用subprocess模块管理子进程">36. 用subprocess模块管理子进程</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">proc = subprocess.Popen([<span class="string">&#x27;echo&#x27;</span>, <span class="string">&#x27;hello&#x27;</span>], stdout=subprocess.PIPE)</span><br><span class="line">out, err = proc.communicate()</span><br><span class="line"><span class="built_in">print</span>(out.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p>把子进程从父进程中剥离</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_sleep</span>(<span class="params">period</span>):</span><br><span class="line">    proc = subprocess.Popen([<span class="string">&#x27;sleep&#x27;</span>, <span class="built_in">str</span>(period)])</span><br><span class="line">    <span class="keyword">return</span> proc</span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line">procs = []</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    proc = run_sleep(<span class="number">0.1</span>)</span><br><span class="line">    procs.append(proc)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> proc <span class="keyword">in</span> procs:</span><br><span class="line">    proc.communicate()</span><br><span class="line">end = time.time()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Finished in %.3f seconds&#x27;</span> % (end - start))</span><br></pre></td></tr></table></figure>

<h2><span id="37-可以用线程执行阻塞式io但不要用它做并行计算">37. 可以用线程执行阻塞式IO，但不要用它做并行计算</span></h2><ul>
<li>受到全局解释器锁（GIL）限制，多条Python线程不能在多个CPU核心上平行地执行字节码</li>
</ul>
<h2><span id="38-在线程中使用lock来防止数据竞争">38. 在线程中使用Lock来防止数据竞争</span></h2><ul>
<li>GIL不会保护开发者自己代码， 同一时刻固然只能有一个Python线程运行，但这个线程正在操作某个数据结构时，其他线程可能会打断它，也就是说Python解释器来执行两个连续字节码指令时，其他线程可能会中途插进来。</li>
</ul>
<p>threading.Lock类实现了互斥锁</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LockingCounter</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">		<span class="variable language_">self</span>.lock = Lock()</span><br><span class="line">		<span class="variable language_">self</span>.count = <span class="number">0</span></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">increment</span>(<span class="params">self, offset</span>):</span><br><span class="line">		<span class="keyword">with</span> <span class="variable language_">self</span>.lock:</span><br><span class="line">			<span class="variable language_">self</span>.count += offset</span><br></pre></td></tr></table></figure>

<h2><span id="39-用queue协调各线程之间的工作">39. 用Queue协调各线程之间的工作</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Queue</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">q = Queue.Queue(<span class="number">10</span>=</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">producer</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        q.put(i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">consumer</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        <span class="built_in">print</span>(q.get())</span><br><span class="line"></span><br><span class="line">threads = []</span><br><span class="line"></span><br><span class="line">t1 = threading.Thread(target=consumer)</span><br><span class="line">t2 = threading.Thread(target=producer)</span><br></pre></td></tr></table></figure>

<h2><span id="40考虑用协程并发地运行多个函数">40.考虑用协程并发地运行多个函数</span></h2><ul>
<li>对于生成器的yield表达式来说，外部代码通过send方法传给生成器的那个值，就是该表达式所具备的值</li>
</ul>
<h2><span id="x2041-考虑用concurrentfutures实现平行计算">&#x20;41. 考虑用concurrent.futures实现平行计算</span></h2><ul>
<li>multiprocessing模块可用于实现平行计算，利用multiprocessing模块最恰当做法，是通过内置concurrent.futures模块及其ProcessPoolExecutor类使用它</li>
</ul>
<h1><span id="第6章-内置模块">第6章 内置模块</span></h1><h2><span id="x2042-用functoolswraps定义函数修饰器">&#x20;42. 用functools.wraps定义函数修饰器</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">trace</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        result = func(*args, **kwargs)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;%s(%r, %r) -&gt; %r&#x27;</span> % (func.__name__, args, kwargs, result))</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@trace</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fibonacci</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">if</span> n <span class="keyword">in</span> (<span class="number">0</span>, <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    <span class="keyword">return</span> fibonacci(n - <span class="number">2</span>) + fibonacci(n - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(fibonacci(<span class="number">3</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li>Python为修饰器提供专门语法，使得程序运行时，能用一个函数修改另一个函数</li>
</ul>
<h2><span id="43-考虑以contextlib和with语句改写可复用的tryx2ffinally代码">43. 考虑以contextlib和with语句改写可复用的try&#x2F;finally代码</span></h2><p>用with语句代替try… finally，例如</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/path/to/file&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">	f.read()</span><br></pre></td></tr></table></figure>

<h2><span id="44-用copyreg实现可靠pickle操作">44. 用copyreg实现可靠pickle操作</span></h2><p>内置的pickle模块能够将Python对象字节序列转化为字节流，也能把字节反序列化成Python对象</p>
<h2><span id="45-使用datatime模块处理本地时间而不是time">45. 使用datatime模块处理本地时间而不是time</span></h2><ul>
<li>不要用time模块在不同时区进行转换</li>
<li>开发者总是应该先把时间表示成UTC，然后对其转换，最后再转回本地时间</li>
</ul>
<h2><span id="46-使用内置算法和数据结构">46. 使用内置算法和数据结构</span></h2><ul>
<li>双向队列 deque</li>
<li>有序字典 OrderedDict (按照键插入顺序，保留键值对在字典中次序）</li>
<li>优先级队列 heapq</li>
<li>二分查找 bisect</li>
<li>迭代器有关 itertools</li>
</ul>
<h2><span id="47重视精确度场合应该使用decimal">47.重视精确度场合，应该使用decimal</span></h2><p>Decimal类适合用在对精度要求高，对舍入行为要求严格的场合，例如：涉及货币计算的场合</p>
<h2><span id="48-学会安装由python开发者社区构建的模块x20">48. 学会安装由Python开发者社区构建的模块&#x20;</span></h2><ul>
<li>PyPI (Python Package Index) 包含许多常用软件包， pip命令行工具可以从PyPI中安装软件包</li>
</ul>
<h1><span id="第7章-协作开发">第7章 协作开发</span></h1><h2><span id="49-为每个函数-类和模块编写文档字符串">49. 为每个函数、类和模块编写文档字符串</span></h2><p><strong>为模块编写文档</strong></p>
<ul>
<li>每个模块应该有顶级的docstring</li>
<li>头一行文字，用一句话描述本模块用途，接着一段话包含一些细节信息，把与本模块操作相关内容，告诉模块使用者。</li>
<li>还可以在模块的dockstring中，强调本模块里比较重要类和函数，使开发者据此了解该模块用法</li>
</ul>
<p>举例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># words.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="string">&quot;&quot;&quot; Library for XXX...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Testing how words XXX...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Available functions:</span></span><br><span class="line"><span class="string"> - palindrome: Determine if a word ...</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>为类编写文档</strong></p>
<p>每一个类应该有docstring，写法与模块级的docstring大致相同，如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Player</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">	<span class="string">&quot;&quot;&quot;Represents a player of the game.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	Subclassses may override ...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	Public attributes:</span></span><br><span class="line"><span class="string">	- power: ...</span></span><br><span class="line"><span class="string">	- coins: ...</span></span><br><span class="line"><span class="string">	&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>为函数编写文档</strong></p>
<p>函数的docstring，第一行用一句话描述函数功能，接下来用一段话描述具体行为和函数参数。 若函数由返回值，应该在docstring中写明</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">find_anagrams</span>(<span class="params">word, dictionary</span>):</span><br><span class="line">	<span class="string">&quot;&quot;&quot;Find all anagrams for a word.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	This function only runs as fast as the test for membership in the dictionary container...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	Args:</span></span><br><span class="line"><span class="string">		word: String of the target word.</span></span><br><span class="line"><span class="string">		dictionary: Container with all strings that are known to be actual words.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	Returns:</span></span><br><span class="line"><span class="string">		List of anagrams that were found. Empty if none were found.</span></span><br></pre></td></tr></table></figure>
<p>作者的建议：</p>
<ul>
<li>如果函数没有参数，仅有一个简单返回值，那么只需一句话描述该函数就够了</li>
<li>如果函数没有返回值，不要在docstring里提及，不要出现return None这种说法</li>
<li>如果正常使用中不会抛异常，就不要在docstring提到异常</li>
<li>如果函数接收可变参数，应该在文档中描述*args, **kwargs用途</li>
<li>如果函数参数有默认值，应该指出这些默认值</li>
</ul>
<h2><span id="50-用包安排模块并提供稳固api">50. 用包安排模块，并提供稳固API</span></h2><p>在目录中放入名为__init__.py的空文件，就可以采用相对于该目录的路径，引入目录中其他Python文件，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">main.py</span><br><span class="line">mypackage/__init__.py</span><br><span class="line">mypackage/utils.py</span><br></pre></td></tr></table></figure>

<p>在main.py中引入utils模块</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"><span class="keyword">from</span> mypackage <span class="keyword">import</span> utils</span><br></pre></td></tr></table></figure>

<p><strong>as子句可以给引入当前作用域的属性重新起名，解决冲突</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> analysis.utils <span class="keyword">import</span> inspect <span class="keyword">as</span> analysis_inspect</span><br><span class="line"><span class="keyword">from</span> frontend.utils <span class="keyword">import</span> inspect <span class="keyword">as</span> frontend_inspect</span><br></pre></td></tr></table></figure>

<p>尽量不要使用import *语句，而是应该用from x import y，明确指出自己想要引入的名称</p>
<h2><span id="51-为自编的模块定义根异常以便将调用者与api隔离">51. 为自编的模块定义根异常，以便将调用者与API隔离</span></h2><h2><span id="52-用适当方式打破循环依赖关系">52. 用适当方式打破循环依赖关系</span></h2><ul>
<li>如果两个模块必须相互调用对方，才能完成引入操作，就会出现循环依赖现象，这可能导致程序启动时崩溃</li>
<li>打破循环依赖关系最佳方案，是把导致两个模块互相依赖的那部分代码，重构为单独模块，并把它放在依赖树底部</li>
</ul>
<h2><span id="53-用虚拟环境隔离项目并重建其依赖关系">53. 用虚拟环境隔离项目，并重建其依赖关系</span></h2><h1><span id="x20第8章-部署">&#x20;第8章 部署</span></h1><h2><span id="54-考虑用模块级别代码配置不同部署环境x20">54. 考虑用模块级别代码配置不同部署环境&#x20;</span></h2><h2><span id="55-通过repr字符串输出调试信息">55. 通过repr字符串输出调试信息</span></h2><p>简单的print不能打印出值的类型信息，可以用repr获取类型信息</p>
<h2><span id="56-用unittest测试全部代码">56. 用unittest测试全部代码</span></h2><h2><span id="57-用pdb实现交互调试">57. 用pdb实现交互调试</span></h2><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.python.org/zh-cn/3/library/pdb.html">https://docs.python.org/zh-cn/3/library/pdb.html</a></p>
<h2><span id="58-先分析性能然后再优化">58. 先分析性能，然后再优化</span></h2><h2><span id="59-用tracemalloc掌握内存使用和泄漏情况">59. 用tracemalloc掌握内存使用和泄漏情况</span></h2>
    </div>

    
    
    
        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.jpg" alt="PC 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.jpg" alt="PC 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>PC
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://pcj600.github.io/2023/0812215151.html" title="Effective Python 笔记">https://pcj600.github.io/2023/0812215151.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>所有文章都欢迎转载, 注明出处即可.
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Python/" rel="tag"><i class="fa fa-tag"></i> Python</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/0719214818.html" rel="prev" title="流畅的Python 笔记">
      <i class="fa fa-chevron-left"></i> 流畅的Python 笔记
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/0815215310.html" rel="next" title="Python的Lamdba函数是什么，应用场景是什么?">
      Python的Lamdba函数是什么，应用场景是什么? <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text">第1章：用Pythonic方式来思考</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text"> 1. 用Pythonic方式来思考</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text"> 2. 遵循PEP8风格</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">3. 了解bytes, str, unicode区别</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">4. 用辅助函数取代复杂表达式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">5. 了解切割序列的方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">6. 单次切片操作内，不要同时指定start, end, stride</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text"> 7. 用列表推导取代map, filter</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">8. 不要使用含有两个以上表达式的列表推导</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">9. 用生成器表达式改写数据量较大的列表推导</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">10. 尽量用enumerate取代range</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">11. 用zip函数同时遍历两个迭代器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">12. 不要在for和while循环后写else块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">13. 合理利用try&#x2F;except&#x2F;else&#x2F;finally结构中每个代码块</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text">第2章 函数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">14. 尽量用异常来表示特殊情况，而不返回Nones</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">15. 了解如何在闭包里使用外围作用域中的变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">16. 用生成器改写直接返回列表函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">17. 在参数上迭代时，多加小心</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">18. 用数量可变位置参数减少视觉杂讯 (visual noise)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">19. 用关键字参数表达可选的行为</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">20. 用None和文档字符串描述含有动态默认值的参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">21. 用只能以关键字形式指定的参数来确保代码明晰</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text">第3章 类与继承</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">22. 尽量用辅助类维护程序状态，而不要用字典和元组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">23. 简单的接口应该接受函数，而不是类的实例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">24. 以@classmethod形式的多态去通用地构建对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">25. 用super初始化父类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">26. 只在使用Mix-in组件制作工具类时进行多重继承</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">27. 多用public属性，少用private属性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">28. 继承collections.abc以实现自定义的容器类型</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text">第4章 元素与属性</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">29. 用纯属性取代get和set方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">30. 考虑用@property代替属性重构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">31. 用描述符来改写需要复用的@property方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">32. 用getattr, getattribute, setattr实现按需生成操作 (惰性方式加载并保存对象属性）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">33. 用元类验证子类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">34. 用元类注册子类</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text">第5章 并发及并行</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">36. 用subprocess模块管理子进程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">37. 可以用线程执行阻塞式IO，但不要用它做并行计算</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">38. 在线程中使用Lock来防止数据竞争</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">39. 用Queue协调各线程之间的工作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">40.考虑用协程并发地运行多个函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text"> 41. 考虑用concurrent.futures实现平行计算</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text">第6章 内置模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text"> 42. 用functools.wraps定义函数修饰器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">43. 考虑以contextlib和with语句改写可复用的try&#x2F;finally代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">44. 用copyreg实现可靠pickle操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">45. 使用datatime模块处理本地时间而不是time</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">46. 使用内置算法和数据结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">47.重视精确度场合，应该使用decimal</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">48. 学会安装由Python开发者社区构建的模块 </span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text">第7章 协作开发</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">49. 为每个函数、类和模块编写文档字符串</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">50. 用包安排模块，并提供稳固API</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">51. 为自编的模块定义根异常，以便将调用者与API隔离</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">52. 用适当方式打破循环依赖关系</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">53. 用虚拟环境隔离项目，并重建其依赖关系</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text"> 第8章 部署</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">54. 考虑用模块级别代码配置不同部署环境 </span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">55. 通过repr字符串输出调试信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">56. 用unittest测试全部代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">57. 用pdb实现交互调试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">58. 先分析性能，然后再优化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">59. 用tracemalloc掌握内存使用和泄漏情况</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="PC"
      src="/images/avatar.jpg">
  <!-- <p class="site-author-name" itemprop="name">PC</p> -->
  <div class="site-description" itemprop="description">PC的博客</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">180</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">38</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">50</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/pcj_888" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;pcj_888" rel="noopener external nofollow noreferrer" target="_blank"><i class="fab fa-weibo fa-fw"></i>CSDN</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        



<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">PC</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">808k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">12:15</span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener external nofollow noreferrer" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener external nofollow noreferrer" target="_blank">NexT.Pisces</a> 强力驱动
  </div>
-->

        
  <script async src="/js/busuanzi.js"></script>









      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right"},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2}});</script></body>
</html>

<script type="text/javascript" src="/js/clicklove.js"></script>
